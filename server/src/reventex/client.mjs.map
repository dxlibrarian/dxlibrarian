{"version":3,"file":"client.mjs","sources":["src/entity-id/index.ts","src/constants/index.ts","src/projection/index.ts","src/client/index.ts","node_modules/@babel/runtime/helpers/extends.js","src/utils/serialize.ts","src/utils/deserialize.ts"],"sourcesContent":["export interface TEntityId {\n  entityName: string;\n  documentId: string;\n}\n\nconst MACHINE_ID = Math.floor(Math.random() * 0xffffff);\nlet index = Math.floor(Math.random() * 0xffffff);\nconst pid =\n  (typeof process === 'undefined' || typeof process.pid !== 'number'\n    ? Math.floor(Math.random() * 100000)\n    : process.pid) % 0xffff;\n\nfunction next(): number {\n  return (index = (index + 1) % 0xffffff);\n}\n\nfunction hex(length: number, n: number): string {\n  const h = n.toString(16);\n  return h.length === length ? h : '00000000'.substring(h.length, length) + h;\n}\n\nfunction createDocumentId(): string {\n  const time = Math.floor(Date.now() / 1000) % 0xffffffff;\n  return hex(8, time) + hex(6, MACHINE_ID) + hex(4, pid) + hex(6, next());\n}\n\nconst validateRegExp = /^[0-9A-F]{24}$/i;\n\nexport class EntityId implements TEntityId {\n  entityName: string;\n  documentId: string;\n  documentVersion?: string;\n  constructor(entityName: string, documentId: string) {\n    if (entityName == null || entityName.constructor !== String) {\n      throw new Error(`Argument \"entityName\" must be a string`);\n    }\n\n    if (documentId == null || documentId.constructor !== String) {\n      throw new Error(`Argument \"documentId\" must be a string\"`);\n    }\n    if (!validateRegExp.test(documentId)) {\n      throw new Error(\n        `Incorrect argument \"documentId\" = ${JSON.stringify(\n          documentId\n        )}. RegExp = ${validateRegExp}`\n      );\n    }\n\n    this.entityName = entityName;\n    this.documentId = documentId;\n  }\n}\n\nexport const entityId = (\n  entityName: string,\n  documentId: string = createDocumentId()\n) => new EntityId(entityName, documentId);\n","export const PRIVATE = '@@REVENTEXT';\n","import { IndexOptions } from 'mongodb';\n\nimport { TEventHandler } from '../event-handler';\nimport { PRIVATE } from '../constants';\n\ntype Index = {\n  [key: string]: 1 | -1;\n};\n\nexport class Projection {\n  [PRIVATE]: {\n    name: string;\n    indexes: Array<[Index] | [Index, IndexOptions]>;\n    eventHandlers: {\n      [key: string]: TEventHandler;\n    };\n  };\n\n  constructor() {\n    Object.defineProperty(this, PRIVATE, {\n      value: Object.create(null)\n    });\n    this[PRIVATE].eventHandlers = {};\n    this[PRIVATE].indexes = [];\n  }\n  name(name: string) {\n    if (this[PRIVATE].name != null) {\n      throw new Error(`Name already exists`);\n    }\n    this[PRIVATE].name = name;\n    return this;\n  }\n  index(keyAndIndexTypeSpecification: Index, options?: IndexOptions) {\n    this[PRIVATE].indexes.push(\n      options != null\n        ? [keyAndIndexTypeSpecification, options]\n        : [keyAndIndexTypeSpecification]\n    );\n    return this;\n  }\n  on(eventType: string, eventHandler: TEventHandler) {\n    if (this[PRIVATE].eventHandlers[eventType] != null) {\n      throw new Error(`Event handler \"${eventType}\" already exists`);\n    }\n    this[PRIVATE].eventHandlers[eventType] = eventHandler;\n    return this;\n  }\n}\n\nconst projection = {\n  name(name: string) {\n    const instance = new Projection();\n    return instance.name(name);\n  },\n  index(keyAndIndexTypeSpecification: Index, options?: IndexOptions) {\n    const instance = new Projection();\n    return instance.index(keyAndIndexTypeSpecification, options);\n  },\n  on(eventType: string, eventHandler: TEventHandler) {\n    const instance = new Projection();\n    return instance.on(eventType, eventHandler);\n  }\n};\n\nexport { projection };\n","import { PRIVATE } from '../constants';\nimport { Projection } from '../projection';\nimport { TEvent } from '../event';\nimport { Middleware, Reducer } from 'redux';\n\ntype TPublishResult = object;\ntype TPublish = (events: Array<TEvent>) => Promise<TPublishResult>;\n\ntype TResolverResult = object;\ntype TRead = (\n  resolverName: string,\n  resolverArgs: Object\n) => Promise<TResolverResult>;\n\nclass Client {\n  reducer: Reducer;\n  middleware: Middleware;\n  constructor() {\n    const self = this as any;\n    Object.defineProperty(self, PRIVATE, {\n      value: Object.create(null)\n    });\n    self[PRIVATE].projections = [];\n    this.reducer = (state = {}) => state;\n    this.middleware = store => next => action => {\n      return next(action);\n    };\n  }\n  publish(implementation: TPublish) {\n    const self = this as any;\n    self[PRIVATE].publish = implementation;\n    return this;\n  }\n  read(implementation: TRead) {\n    const self = this as any;\n    self[PRIVATE].read = implementation;\n    return this;\n  }\n  projections(projections: Array<Projection>) {\n    const self = this as any;\n    self[PRIVATE].projections.push(...projections);\n    return this;\n  }\n}\n\nexport const client = {\n  publish(implementation: TPublish): Client {\n    const instance = new Client();\n    return instance.publish(implementation);\n  },\n  read(implementation: TRead): Client {\n    const instance = new Client();\n    return instance.read(implementation);\n  },\n  projections(projections: Array<Projection>): Client {\n    const instance = new Client();\n    return instance.projections(projections);\n  }\n};\n","function _extends() {\n  module.exports = _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nmodule.exports = _extends;","import { EntityId } from '../entity-id';\nimport { TEvent } from '../event';\n\nfunction wrap(value: EntityId | Array<any> | { [key: string]: any }): any {\n  if (value instanceof EntityId) {\n    return { t: 'e', v: [value.entityName, value.documentId] };\n  }\n  if (Array.isArray(value)) {\n    return recursiveWrap(value);\n  } else if (value === Object(value)) {\n    return { t: 'o', v: recursiveWrap(value) };\n  } else {\n    return recursiveWrap(value);\n  }\n}\n\nfunction recursiveWrap(source: EntityId | Array<any> | { [key: string]: any }) {\n  if (Array.isArray(source)) {\n    return source.map(value => wrap(value));\n  } else if (source === Object(source)) {\n    const copyValue: { [key: string]: any } = {};\n    for (let key in source) {\n      if (!source.hasOwnProperty(key)) {\n        continue;\n      }\n      copyValue[key] = wrap(\n        (source as { [key: string]: any })[key] as { [key: string]: any }\n      );\n    }\n    return copyValue;\n  } else {\n    return source;\n  }\n}\n\nexport const serialize = (events: Array<TEvent>): string => {\n  const eventCount = events.length;\n  const result = [];\n  for (let eventIndex = 0; eventIndex < eventCount; eventIndex++) {\n    const event = events[eventIndex];\n    result.push({\n      ...event,\n      payload: recursiveWrap(event.payload)\n    });\n  }\n  return JSON.stringify(result);\n};\n","import { entityId } from '../entity-id';\nimport { TEvent } from '../event';\n\nfunction unwrap(value: { t: string; v: string }): any {\n  if (Array.isArray(value)) {\n    return recursiveUnwrap(value);\n  } else if (value === Object(value)) {\n    if (value.t === 'e') {\n      return entityId(value.v[0], value.v[1]);\n    } else if (value.t === 'o') {\n      return recursiveUnwrap(value.v);\n    } else {\n      throw new Error(`Incorrect value ${JSON.stringify(value)}`);\n    }\n  } else {\n    return recursiveUnwrap(value);\n  }\n}\n\nfunction recursiveUnwrap(\n  source: Array<any> | { [key: string]: any } | any\n): any {\n  if (Array.isArray(source)) {\n    return source.map(value => unwrap(value));\n  } else if (source === Object(source)) {\n    const copyValue: { [key: string]: any } = {};\n    for (let key in source) {\n      if (!source.hasOwnProperty(key)) {\n        continue;\n      }\n      copyValue[key] = unwrap(source[key]);\n    }\n    return copyValue;\n  } else {\n    return source;\n  }\n}\n\nexport function deserialize(eventsAsString: string): Array<TEvent> {\n  const events = JSON.parse(eventsAsString);\n  const eventCount = events.length;\n  for (let eventIndex = 0; eventIndex < eventCount; eventIndex++) {\n    const event = events[eventIndex];\n    if (event.hasOwnProperty('payload')) {\n      event.payload = recursiveUnwrap(event.payload);\n    }\n  }\n  return events;\n}\n"],"names":["MACHINE_ID","Math","floor","random","index","pid","process","next","hex","length","n","h","toString","substring","createDocumentId","time","Date","now","validateRegExp","EntityId","entityName","documentId","constructor","String","Error","test","JSON","stringify","entityId","PRIVATE","Projection","Object","defineProperty","value","create","eventHandlers","indexes","name","keyAndIndexTypeSpecification","options","push","on","eventType","eventHandler","projection","instance","Client","self","projections","reducer","state","middleware","store","action","publish","implementation","read","client","wrap","t","v","Array","isArray","recursiveWrap","source","map","copyValue","key","hasOwnProperty","serialize","events","eventCount","result","eventIndex","event","payload","unwrap","recursiveUnwrap","deserialize","eventsAsString","parse"],"mappings":"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"}